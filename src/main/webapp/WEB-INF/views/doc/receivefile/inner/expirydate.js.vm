#@script()
<script>
    //类型变化时改变 限时办结要求
	function initRemoteDocSwapTypeRadio(){
		$('input[name="documentType"]').on('click',function(){
			 var type = $(':radio[name="documentType"]:checked').val();
			 $("#emergencyLevel").html('');
			 var str = '';
			 if(1 == type){
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="1" #if("1"=="$!{obj.deadlineType}") checked #end/>特急&nbsp;</label>';
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="2" #if("2"=="$!{obj.deadlineType}") checked #end/>急件</label>';
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="3" #if("3"=="$!{obj.deadlineType}" || ""=="$!{obj.deadlineType}") checked #end/>普通</label>';
				 $("#emergencyLevel").html(str);
				 initEmergencyLevelRadio();
				 $("#eme_lv").val(3);
				 #if("3"=="$!{obj.deadlineType}" || ""=="$!{obj.deadlineType}") 
        			$('input[name="deadlineType"][value=3]').click();
        		 #else
        			$('input[name="deadlineType"][value="$!{obj.deadlineType}"]').click();
        		 #end

				 
			 }else{
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="1" #if("1"=="$!{obj.deadlineType}") checked #end/>特急&nbsp;</label>';
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="2" #if("2"=="$!{obj.deadlineType}") checked #end/>急件</label>';
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="4" #if("4"=="$!{obj.deadlineType}" || ""=="$!{obj.deadlineType}") checked #end/>普通一类</label>';
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="5" #if("5"=="$!{obj.deadlineType}") checked #end/>普通二类</label>';
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="6" #if("6"=="$!{obj.deadlineType}") checked #end/>普通三类</label>';
				 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="7" #if("7"=="$!{obj.deadlineType}") checked #end/>其它</label>';
				 $("#emergencyLevel").html(str);
				 initEmergencyLevelRadio();
				 $("#eme_lv").val(3);
				 #if("4"=="$!{obj.deadlineType}" || ""=="$!{obj.deadlineType}") 
        			$('input[name="deadlineType"][value=4]').click();
        		 #else
        			$('input[name="deadlineType"][value="$!{obj.deadlineType}"]').click();
        		 #end
				 
				 
			 }

        });

	}

	//限时办结要求 变化时触发事件
	function initEmergencyLevelRadio(){
		$('input[name="deadlineType"]').on('click',function(){
			var level = $(':radio[name="deadlineType"]:checked').val();
			$('#limitDay').textbox('textbox').attr('readonly',true);
			var type = $(':radio[name="documentType"]:checked').val();
			var map = {};
			
			#foreach($item in $deadLineTypeMap.entrySet())  
			   map[$item.key] = $item.value; 
            #end
			var value = map[level + type];
			
			$("#nodeExpireSet").hide();
			if(level == 1){
				$('#limitDay').textbox('setValue','1');
				$('#emergencyLevelName').textbox('setValue','特急');
				$("#eme_lv").val(1);
				showLimitDaySpan(1);
			}else if(level == 2){
				$('#limitDay').textbox('setValue','5');
				$('#emergencyLevelName').textbox('setValue','急件');
				$("#eme_lv").val(2);
				showLimitDaySpan(1);
			}else if(level == 3){
				$('#limitDay').textbox('setValue','15');
				$('#emergencyLevelName').textbox('setValue','无');
				$("#eme_lv").val(3);
				showLimitDaySpan(1);
			}else if(level == 4){
				$('#limitDay').textbox('setValue','15');
				$('#emergencyLevelName').textbox('setValue','无');
				$("#eme_lv").val(3);
				showLimitDaySpan(1);
			}else if(level == 5){
				$('#limitDay').textbox('setValue','30');
				$('#emergencyLevelName').textbox('setValue','无');
				$("#eme_lv").val(3);
				showLimitDaySpan(1);
			}else if(level == 6){
				$('#limitDay').textbox('setValue','120');
				$('#emergencyLevelName').textbox('setValue','无');
				$("#eme_lv").val(3);
				showLimitDaySpan(1);
			}else if(level == 7){
				$('#limitDay').textbox('setValue','');
				$('#emergencyLevelName').textbox('setValue','无');
				$('#limitDay').textbox('textbox').attr('readonly',false);
				$("#eme_lv").val(3);
				showLimitDaySpan(0);
				$("#nodeExpireSet").show();
			}
			//如果初始化设置了限时办结要求对应天数，则使用设置的值
			if(value!=""&&value!=undefined){
				$('#limitDay').textbox('setValue',value);
			}
		});
	}
	
	function setLimit(){
        var a = $("input[name='urgencyLevel']:checked").val();
    
        switch(a) {
           case '1':  showLimitDaySpan(1);  $("#limitDay").textbox("setValue","1");  break;
           case '2':  showLimitDaySpan(1);  $("#limitDay").textbox("setValue","5");  break;
           case '3':  showLimitDaySpan(1);  $("#limitDay").textbox("setValue","15");  break;
           case '4':  showLimitDaySpan(1);  $("#limitDay").textbox("setValue","30");  break;
           case '5':  showLimitDaySpan(1);  $("#limitDay").textbox("setValue","120");  break;
           default:  showLimitDaySpan(0) ;
        }
	}
	
	function showLimitDaySpan(p){
		var span1 = $("#ltday1");
		var span2 = $("#ltday2");
		if (p == 1) {
			span1.css("display", "block");
			span2.css("display", "none");
			$('#expiryDate').datebox({   
    			required:false
    		});
		} else {
			span1.css("display", "none");
			span2.css("display", "block");
			$("#limitDay").textbox("setValue","");
			$('#expiryDate').datebox({   
    			required:true
    		});
    		//设置限办时间范围，大于当天
    		$('#expiryDate').datebox().datebox('calendar').calendar({
				validator: function(date){
					var now = new Date();
					var d1 = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1);
					return d1<=date ;
				}
			});
		}
	}
	
	function setLimit(ck){
        if(ck.checked) {
    		$("#expiryDate").datebox("setValue","");
    	   	$('#expiryDate').datebox({   
    			required:false
            });
    		$("#nodeExpireSet").hide();
    		$("#nodeIds").val('');
    		$("#nodeExpireDates").val('');
    		$("#ltday3").hide();
        } else {
    		$("#ltday3").show();
    		$("#nodeExpireSet").show();
        }
	}
	
	//限办时间触发函数
	function showworktime(newValue, oldValue){
        var day =newValue;
        ##替换非数字
        //day=day.replace(/\D/g,"");
        if (day== ""|| day =="0") {
            $("#limitDay").val("");
            $("#receiveFileDisplayLimitTime").text("");
			$("#expiryDate1").val("");
            return false;
        }
        jQuery.ajax({
            url:"$link.getContextURL()/doc/event/getLimitTime.json",
            data:{
                limitDay: day
            },
            type:"post",
            async:false,
            dataType:"text",
            success:function(data) {
				$("#expiryDate1").val(data);
                var value = data.substr(0, data.indexOf(' ')).split("-");
                var displayLimitTime = "";
                displayLimitTime = value[0] + "年" + value[1] + "月" + value[2] + "日";

                $("#receiveFileDisplayLimitTime").text(" 至  " + displayLimitTime);
            }
        });
    }
	
	//环节限办时间设置
	function installNodeExpire(flowType){
        //var flowId = $('#flowId').combobox('getValue');
		var flowId = $("#flowId").val();
      	var expiryDate = $("#expiryDate").textbox("getValue");
      	var nodeIds = $("#nodeIds").val();
      	var nodeExpireMinutes = $("#nodeExpireMinutes").val();
      	var _callbackname = 'fnNodeExpireCallback';
        var _url = "$link.getContextURL()/doc/nodeExpireDate/editNodeExpireDate?expiryDate=" + expiryDate + "&flowId=" + flowId +"&nodeExpireMinutes=" + nodeExpireMinutes + "&nodeIds=" + nodeIds + "&flowType=" + flowType;
        var _callback_fn = window[_callbackname];
        var dfn = top.window.openSelectDialogFrameDialog;
        if (typeof dfn === "function") {
            dfn(_url, _callback_fn);
        }
        return false;
	}
	
	//环节限办时间设置  回填函数
	function fnNodeExpireCallback(obj){
		if(obj){
			var nodeIds = obj.nodeIds;
			var nodeExpireMinutes = obj.nodeExpireMinutes;
			$("#nodeIds").val(nodeIds);
			$("#nodeExpireMinutes").val(nodeExpireMinutes);
		}
	}
	
	//生成字号
	function createDocCode(fileType){
		var docCode1 = $('#docCode1').textbox('getValue');
		if(""==docCode1){
			top.CC.messager({ title:'提示',msg:'请先选择字号' });
			return;
		}
		
		var year = $("#docCode2").combobox('getValue');
		top.CC.loading('生成中...');
		$.post("$link.getContextURL()/doc/event/createDocCode.json",{id:'$!{obj.id}',docCodeName:docCode1, year:year, fileType:fileType},function(result){
			top.CC.loaded();
			if(result != null && result != ""){
				$("#docCode3").textbox('setValue', result);
			}else{
				$("#docCode3").textbox('setValue', '1');
			}
		});
	}
</script>
#end