<div id="cc_layout" class="easyui-layout" fit="true" >
    <div id="tb" class="top-menu datagrid-toolbar toolbar-borderbottom">
        ##<a href="javascript:;" class="easyui-linkbutton" iconCls="icon-download-alt" onclick = "exportDocCount()" plain="true">导出</a>
        <a class="easyui-linkbutton l-btn-plain-search" data-options="iconCls:'icon-statistics',plain:true" onclick="researchOpen()">统计</a>
        ##<a href="javascript:;" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="columnDiagram('')">直方图</a>
        ##<a href="javascript:;" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="pieDiagram('')">饼图</a>
        <i></i>
        <a onclick="top.CC.closeCurTab()" class="easyui-linkbutton l-btn-plain-quit" data-options="iconCls:'icon-quit-small',plain:true">关闭</a>

    </div>

    <div class="cc-tableWrap" data-options="region:'center',border:false"  style="width:350px;padding:5px;">
        <table id="dg" style="width:99%;">
            <thead>
                <tr>
                    <th style="width:25%" data-options="field:'itemName', formatter:detailUrl">部门/人员</th>
                    <th style="width:8%" data-options="field:'createNum'">创建文数</th>
                    <th style="width:8%" data-options="field:'dealed'">经办</th>
                    <th style="width:8%" data-options="field:'finished'">办结</th>
                    <th style="width:8%" data-options="field:'fordo'">待办</th>
                    <th style="width:8%" data-options="field:'readed'">已阅</th>
                    <th style="width:8%" data-options="field:'reading'">待阅</th>
                    <th style="width:15%" data-options="field:'operate',align:'center',formatter:operaterFormatter,width:50">统计图</th>
                </tr>
            </thead>
        </table>
        <div class="cc-operateColum">
        <a  href='javascript:;' class="easyui-linkbutton" iconCls="icon-search"
            plain="true" onclick="columnChart('__uname__', '__dataStr__')">直方图</a>
        <a  href='javascript:;' class="easyui-linkbutton" iconCls="icon-search"
            plain="true" onclick="pieChart('__uname__', '__dataStr__')">饼图</a>
        </div>
    </div>
    <div  data-options="region:'center',border:false" style="padding:5px;">
    </div>
    <div  id="searchDialog" class="easyui-dialog  dialog-tc" title="统计条件" data-options="modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false,buttons:'#bnts'"
             style="width:570px;height:260px;padding:20px 10px; background-color:#f4f4f4;display:none">
        <form id="queryForm">
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td style="text-align: right;width:30%;">姓名：</td>
                    <td style="width:70%;">
                        ##<input type="text" id="userId" name="userId" />
                        ##<input type="text" id="userName" name="userName" value="$!{userName}" style="width:250px;" class="easyui-textbox"/>
                        <input id="userId" name="userId" value="$!{userId}" type="hidden" />
                        <input id="userName" name="userName" value="$!{userName}" class="easyui-textbox" readonly style="width:250px;  height:24px;"/>
                        <a id="selectManDialog" href="javascript:;" iconcls="icon-search" plain="true" title="选择人员"
                            callback=fnSelectManCallback class="easyui-linkbutton" select-dialog=""></a>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right;width:30%;">部门：</td>
                    <td style="width:70%;">
                        <input type="hidden" id="showUsers" name="showUsers" value="$!{showUsers}"/>
                        <input type="hidden" id="deptId" name="deptId" value="$!{deptId}"/>
                        <input type="text" id="deptName" name="deptName" value="$!{deptName}" readonly style="width:250px;" class="easyui-textbox"/>
                        <a id="selectDepDialog" href="javascript:;" plain="true" iconcls="icon-search"
                            callback=fnSelectDepCallback class="easyui-linkbutton" select-dialog="$link.getContextURL()/select/Dep/selectDepTree"></a>
                        ##<a id="selectDepsDialog" href="javascript:;" style="width:10%;" class="easyui-linkbutton" iconcls="icon-search" plain="true"  callback=fnSelectDepsCallback
                        ##class="easyui-linkbutton" select-dialog="$link.getContextURL()/selectDep/selectDeps"></a>
                        ##class="easyui-linkbutton" select-dialog="$link.getContextURL()/selectDep/selectDepTree"></a>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right;width:30%;">日期：</td>
                    <td style="width:70%;">
                        <input id="fromDate" name="fromDate" class="easyui-datebox" value="$!{fromDate}" data-options="editable:false" style="width:110px;">
                        至
                        <input id="toDate" name="toDate" class="easyui-datebox" value="$!{toDate}" data-options="editable:false" style="width:110px;">
                    </td>
                </tr>
            </table>
         </form>
        <div id="bnts" style="top:0px; height:25px; width:auto;">
            <a class="new-but" onclick="formSerach()">确定</a>
            <a class="new-but" onclick="reset()">重置</a>
        </div>
    </div>

</div>

#parse("doc/docstatis/crud.js.vm")
#@script()
<script type="text/javascript">

    var _baseUrl = '$link.getContextURL()/doc/docstatis/';
    var _listJsonUrl = '/listDocCount.json';

    function researchOpen(){
        $('#searchDialog').css('display','block');
        $('#searchDialog').window('center');
        $('#searchDialog').window('open');

        //$('#userId').val('');
        //$('#userName').textbox('setValue','');

        //$('#deptId').val('');
        //$('#deptName').textbox('setValue','');
    }

    function restatis(){
         var _f = $("#form");
        _f.form("clear");
        reset();
        formSerach();
    }

    function openDetail(deptId, deptName){
        var url = _baseUrl + 'docCountList?showUsers=1&deptId=' + deptId + '&deptName=' + encodeURI(deptName);
        top.CC.addTab({title:'个人统计',url:url});
    }


    function detailUrl(value,row) {
        return "<a href='javascript:;' class='font-titlecolor' onclick='openDetail(\"" + row.deptId + "\",\"" + row.deptName + "\")'>"+value+"</a>";
    }


    function operaterFormatter(value,row,index){
        return $(".cc-operateColum",_datagrid.parents(".cc-tableWrap")).html()
            .replace(new RegExp("__uname__",'gm'),row.itemName)
            .replace(new RegExp("__dataStr__",'gm'),row.dataStr);
    }


    function attFlag(value,row,index){
        if(value == '有附件') {
            return "<img src='images/attach.png'/>";
        }
    }
    function formSerach() {
        $('#searchDialog').window('close');
        $('#dg').datagrid('reload');
    }
    function reset(){
        var _qf = $("#queryForm");
        _qf.form("clear");
        $(".easyui-combobox",_qf).each(function(){
            $(this).combobox("select"," ");
        });
    }

    function exportDocCount() {
        $.messager.confirm('提示','确定导出吗?',function(r){
            if (r){
                window.location = "$link.getContextURL()/doc/docstatis/exportDocCount.json?"+$("#queryForm").serialize();;
            }
        });
    }

    // 跳转到直方图
    function columnChart(uname, dataStr){
		top.CC.addTab({title:'统计图',url:"$link.getContextURL()/doc/docstatis/statColumnStatistical?userName="+encodeURI(uname)+"&dataStr="+encodeURI(dataStr)});
    }

    // 跳转到饼图
    function pieChart(uname, dataStr){
        top.CC.addTab({title:'办理情况饼图',url:"$link.getContextURL()/doc/docstatis/statPieStatistical?userName="+encodeURI(uname)+"&dataStr="+encodeURI(dataStr)});
    }

    // 办理人统计图按钮显示
    function dealerCount(value,row,index){
        var btnCol = "<button href='javascript:;' class='easyui-linkbutton' iconCls='icon-search' plain='true' onclick='columnDiagram("+value+")'>直方图</button>" ;
        var btnPie = "<button href='javascript:;' class='easyui-linkbutton' iconCls='icon-search' plain='true' onclick='pieDiagram("+value+")'>饼图</button>" ;
        return btnCol +"&nbsp;&nbsp;"+ btnPie;
    }

     //校验身份证号，手机号码
     $.extend($.fn.validatebox.defaults.rules, {
        integ:{
          validator:function(value,param){
            return /^[+]?[0-9]\d*$/.test(value);
          },
          message: '请输入整数'
        },
        money:{
          validator:function(value,param){
            return /^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/.test(value);
          },
          message: '请输入金额'
        }
      });

<!-----------------------选择部门-------------------------------->
     function fnSelectDepCallback(obj){
        $("#deptId").val(obj.id);
        $("#deptName").textbox('setText',obj.text);
     }


    //选择对话框
    $("#selectDepDialog").each(function() {
        $(this).click(function(){
            var $this = $(this);
            var _callbackname = $this.attr("callback");
            var _url = $this.attr("select-dialog");
            var _callback_fn = window[_callbackname];
            var dfn = top.window.openSelectDialogFrameDialog;
            if (typeof dfn === "function") {
                dfn(_url, _callback_fn);
            }
            return false;
        })
    });


    //人员选择对话框
    $("#selectManDialog").each(function() {
        $(this).click(function(){
            var $this = $(this);
            var _callbackname = $this.attr("callback");
            var _url = "$link.getContextURL()/select/selectSingleManClassify";
            var _callback_fn = window[_callbackname];
            var dfn = top.window.openSelectDialogFrameDialog;
            if (typeof dfn === "function") {
                dfn(_url, _callback_fn);
            }
            return false;
        })
    });

    // 人员选择回调
    function fnSelectManCallback(obj){
        var userName = "";
        var userId = "";

        userName = obj.userName;
        userId = obj.id;

        $('#userName').textbox('setValue', userName);
        $('#userId').val(userId);

    }


</script>
<script src="lib/highcharts-4.2.3/js/highcharts.js" type="text/javascript"></script>
<script src="js/exporting.js" type="text/javascript"></script>
#end