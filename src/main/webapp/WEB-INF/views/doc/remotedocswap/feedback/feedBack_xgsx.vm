<div class="easyui-panel mainborder-Padding" data-options="fit:true,border:false">
  <div id="cc" class="easyui-layout" data-options="fit:true">
      <div data-options="region:'center'" class="mynoborder">
          <form id="feedBackForm" method="post">
              <input name="id" id="id" type="hidden" value="$!{envelope.id}"/>
              <input name="documentType" id="documentType" type="hidden" value="$!{envelope.documentType}"/>
              <input name="feedBackType" id="feedBackType" type="hidden" value="4"/>##修改时限：4
              <table class="table-edit" width="99%" border="0" cellspacing="1" cellpadding="0">
                  <tbody>
                    <tr>
                      <td class="bg-grey">公文标题</td>
                      <td class="bg-white" colspan="3">
                        <input type="text" name="title" class="easyui-textbox" data-options="editable:false" style="width:100%;" value="$!esc.html($!{envelope.title})"/>
                      </td>
                    </tr>
					<tr>
                      <td class="bg-grey">联系人</td>
                      <td class="bg-white">
                        <input type="text" name="contactName" class="easyui-textbox" data-options="validType:'maxLength[10]'" style="width:100%;" value="$!esc.html($!{currentUser.userName})"/>
                      </td>
					   <td class="bg-grey">联系电话</td>
                      <td class="bg-white">
                        <input type="text" name="contactPhone" class="easyui-numberbox" data-options="min:0" style="width:100%;" value="$!{currentUser.mobile}"/>
                      </td>
                    </tr>
					<tr>
                      <td class="bg-grey">限时办结要求</td>
					  <td class="bg-white" colspan="3" id="emergencyLevel">
							<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="1"/>特急&nbsp;</label>
							<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="2"/>急件</label>
							<label><input type="radio" class="easyui-validatebox" checked data-options="required:true" name="deadlineType" value="4"/>普通一类</label>
							<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="5"/>普通二类</label>
							<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="6"/>普通三类</label>
							<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="7"/>其它</label>
					  </td>
                    </tr>
					<tr>
                        <td class="bg-grey">限办工日</td>
                        <td class="bg-white">
                            #*<input style="width:25%;" id="deadlineDay"  name="deadlineDay" editable="false" data-options="required:true,validType:'integer',onChange:showworktime" class="easyui-textbox"  value="15">
                            &nbsp;个工作日&nbsp;<br>
                            <span id="receiveFileDisplayLimitTime" style="color:red; font-weight: bold;"></span>
                            <input type="hidden" id="limitTime" name="limitTime" value="">
								*#
							<div id="ltday1" style="float:left; witdh:60px; display:block">
                    		<input style="width:50px;" id="deadlineDay"  name="deadlineDay" editable="false" data-options="validType:'integer',onChange:showworktime" class="easyui-textbox"  value="15">
                            &nbsp;个工作日&nbsp;
                            <span id="receiveFileDisplayLimitTime" style="color:red; font-weight: bold;"></span>
                            ##<input type="hidden" id="limitTime" name="limitTime" value="">
                      		</div>
    						<div id="ltday2" style="float:left; witdh:200px; display:none">
                    		<input style="width:100px;" id="limitTime" name="limitTime" class="easyui-datebox"  data-options="required:true,editable:false" />
                    		</div>
                        </td>
						<td class="bg-grey">紧急程度</td>
                        <td class="bg-white">
							<input type="hidden" name="emergencyLevel" id="eme_lv" value="3">
                            <input style="width:99%;" id="emergencyLevelName" name="emergencyLevel" editable="false" class="easyui-textbox" value="无"/>
                        </td>
                    </tr>
                  </tbody>
              </table>
          </form>
      </div>
      <div data-options="region:'south'" style="height:52px;padding-top:15px; background-color: #F4F3F3;">
          <div class="bottom-but-dialog">
              <ul>
                  <li><a onclick="send()" class="new-but">发送</a></li>
                  <li><a onclick="back()" class="new-but">关闭</a></li>
              </ul>
          </div>
      </div>
  </div>
</div>
 
#@script()
<script type="text/javascript">


	$(function(){
		initEmergencyLevelRadioChange();
		initEmergencyLevelRadio();
	});
	
    //返回
    function back() {
        $('#editWindow').window('close');
    }

    //发送
    function send(){
        if($("#feedBackForm").form('validate')) {

        top.CC.loading("发送中...");
          $.post("$link.getContextURL()/remotedocswap/send.json",$("#feedBackForm").serialize(),function(result){
            top.CC.loaded();
            if(result.id){
              //$('#id').val(result.id);
              $('#editWindow').window('close');
              top.CC.messager({
                  title:'提示',
                  msg:'发送成功！'
              });
			  top.CC.addTab({title:'发送查询',url:'$link.getContextURL()/remotedocswap/send/list'});
        	  top.CC.closeTab('公文交换详情');
            }else{
              top.CC.messager({
                  title:'提示',
                  msg:'服务器连接不上'
              });
            }
          });
        }
    }
	  
	//根据限时办结要求 切换限时工日
	function showLimitDaySpan(p){
         var span1 = $("#ltday1");
         var span2 = $("#ltday2");
         if (p == 1) {
            span1.css("display", "block");
            span2.css("display", "none");
            //$("#expiryDate").textbox("setValue","");
         } else {
            span1.css("display", "none");
            span2.css("display", "block");
            $("#deadlineDay").textbox("setValue","");
         }
  	}
  
	function showworktime(newValue, oldValue){
        var day =newValue;
        ##替换非数字
        day=day.replace(/\D/g,"");
        if (day== ""|| day =="0") {
            $("#deadlineDay").val("");
            $("#receiveFileDisplayLimitTime").text("");
			$('#limitTime').datebox('setValue','');
            return false;
        }
        jQuery.ajax({
            url:"$link.getContextURL()/doc/event/getLimitTime.json",
            data:{
                limitDay: day
            },
            type:"post",
            async:false,
            dataType:"text",
            success:function(data) {
				$("#limitTime").textbox("setValue",data);
                var value = data.substr(0, data.indexOf(' ')).split("-");
                var displayLimitTime = "";
                displayLimitTime = value[0] + "年" + value[1] + "月" + value[2] + "日";
                $("#receiveFileDisplayLimitTime").text(" 至  " + displayLimitTime);
            }
        });
    }
	
	//初始化 限时办结要求 按钮
	function initEmergencyLevelRadio(){
		 var type = $("#documentType").val();
		 $("#emergencyLevel").html('');
		 var str = '';
		 if(1 == type){
			 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="1"/>特急&nbsp;</label>';
			 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="2"/>急件</label>';
			 str += '<label><input type="radio" class="easyui-validatebox" checked data-options="required:true" name="deadlineType" value="3"/>普通</label>';
			 $("#emergencyLevel").html(str);
			 initEmergencyLevelRadioChange();
			 $("#eme_lv").val(3);
		 }else{
			 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="1"/>特急&nbsp;</label>';
			 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="2"/>急件</label>';
			 str += '<label><input type="radio" class="easyui-validatebox" checked data-options="required:true" name="deadlineType" value="4"/>普通一类</label>';
			 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="5"/>普通二类</label>';
			 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="6"/>普通三类</label>';
			 str += '<label><input type="radio" class="easyui-validatebox" data-options="required:true" name="deadlineType" value="7"/>其它</label>';
			 $("#emergencyLevel").html(str);
			 initEmergencyLevelRadioChange();
			 $("#eme_lv").val(3);
		 }
	
	}
	
	//限时办结要求 变化时触发事件
	function initEmergencyLevelRadioChange(){
		$('input[name="deadlineType"]').on('click',function(){
					var level = $(':radio[name="deadlineType"]:checked').val();
					$('#deadlineDay').textbox('textbox').attr('readonly',true); 
					if(level == 1){
						$('#deadlineDay').textbox('setValue','1');
						$('#emergencyLevelName').textbox('setValue','特急');
						$("#eme_lv").val(1);
						showLimitDaySpan(1);
					}else if(level == 2){
						$('#deadlineDay').textbox('setValue','5');
						$('#emergencyLevelName').textbox('setValue','急件');
						$("#eme_lv").val(2);
						showLimitDaySpan(1);
					}else if(level == 3){
						$('#deadlineDay').textbox('setValue','15');
						$('#emergencyLevelName').textbox('setValue','无');
						$("#eme_lv").val(3);
						showLimitDaySpan(1);
					}else if(level == 4){
						$('#deadlineDay').textbox('setValue','15');
						$('#emergencyLevelName').textbox('setValue','无');
						$("#eme_lv").val(3);
						showLimitDaySpan(1);
					}else if(level == 5){
						$('#deadlineDay').textbox('setValue','30');
						$('#emergencyLevelName').textbox('setValue','无');
						$("#eme_lv").val(3);
						showLimitDaySpan(1);
					}else if(level == 6){
						$('#deadlineDay').textbox('setValue','120');
						$('#emergencyLevelName').textbox('setValue','无');
						$("#eme_lv").val(3);
						showLimitDaySpan(1);
					}else if(level == 7){
						$('#deadlineDay').textbox('setValue','');
						$('#emergencyLevelName').textbox('setValue','无');
						$('#deadlineDay').textbox('textbox').attr('readonly',false); 
						$("#eme_lv").val(3);
						showLimitDaySpan(0);
					}
                });
	}
</script>
#end
